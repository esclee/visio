WITH obj AS
(
  SELECT BI_OPERATION.OPERATIONID
       , BI_PLAN.PLANID
       , to_char(BI_PLAN.PLANNINGYEAR)          AS PLANNINGYEAR
       , BI_PRJPOPULATIONGROUP.ORIGPOPGROUP_ID  AS PPGID
       , BI_GOAL.RFGOALID
       ,  BI_RIGHTSGROUP.RFRIGHTSGROUPID
       ,  BI_OBJECTIVE.OBJECTIVEID OBJID
       ,  BI_OBJECTIVE.RFPROBLEMOBJECTIVEID
       , BI_OBJECTIVE.TAG                       AS EXCLUDED
  FROM   BI_OPERATION
  INNER JOIN BI_PLAN                ON  BI_OPERATION.OPERATIONID=BI_PLAN.OPERATIONID
  INNER JOIN BI_PRJPOPULATIONGROUP  ON  BI_PLAN.PLANID=BI_PRJPOPULATIONGROUP.PLANID
  INNER JOIN BI_GOAL                ON  BI_PRJPOPULATIONGROUP.POPULATIONGROUP_ID=BI_GOAL.POPULATIONGROUPID
  INNER JOIN BI_RFGOALS             ON  BI_GOAL.RFGOALID = BI_RFGOALS.ID
  INNER JOIN BI_RIGHTSGROUP         ON  BI_GOAL.GOALID=BI_RIGHTSGROUP.GOALID
  INNER JOIN BI_RFRIGHTSGROUP       ON  BI_RIGHTSGROUP.RFRIGHTSGROUPID = BI_RFRIGHTSGROUP.ID
  INNER JOIN BI_OBJECTIVE           ON  BI_RIGHTSGROUP.RIGHTSGROUPID=BI_OBJECTIVE.RIGHTSGROUPID
  INNER JOIN BI_RFPROBLOBJ          ON  BI_OBJECTIVE.RFPROBLEMOBJECTIVEID = BI_RFPROBLOBJ.ID
  WHERE PLANNINGYEAR >= 2012 AND
        PLANNINGSTAGE = 8
)
select obj.*
     , BI_PERFINDICATOR.ID                                AS PERFINDICATOR_RFID
     , BI_OUTPUTGRPPERFINDICATOR.ID                       AS PERFINDICATOR_ID
     , ROUND(BI_OUTPUTGRPPERFINDICATOR.IMP_TARGET)        AS PERF_IMP_TARGET
     , ROUND(BI_OUTPUTGRPPERFINDICATOR.COMP_TARGET)       AS PERF_COMP_TARGET
     , ROUND(BI_OUTPUTGRPPERFINDICATOR.MID_YEAR_VALUE)    AS PERF_MID_YEAR_VALUE
     , ROUND(BI_OUTPUTGRPPERFINDICATOR.YEAR_END_VALUE)    AS PERF_YEAR_END_VALUE
     , BI_OUTPUTGRP.RFOUTPUTID
     , BI_OUTPUTGRP.TAG                                   AS PRIORITY
     , BI_PERFINDICATOR.TYPE                              AS INDICATOR_TYPE
     , BI_PERFINDICATOR.ISREVERSAL                        AS REVERSAL
FROM obj
INNER JOIN BI_OUTPUTGRP          ON OBJID=BI_OUTPUTGRP.OBJECTIVEID
INNER JOIN BI_OUTPUTGRPPERFINDICATOR  ON BI_OUTPUTGRP.OUTPUTID =BI_OUTPUTGRPPERFINDICATOR.OUTPUT_ID
INNER JOIN BI_PERFINDICATOR      ON BI_OUTPUTGRPPERFINDICATOR.INDICATOR_ID = BI_PERFINDICATOR.ID



